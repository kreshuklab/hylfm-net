from pathlib import Path

from hylfm.hylfm_types import (
    CriterionChoice,
    DatasetChoice,
    LRSchedThresMode,
    LRSchedulerChoice,
    MetricChoice,
    OptimizerChoice,
    PeriodUnit,
)
from hylfm.model import HyLFM_Net
from hylfm.train import train


if __name__ == "__main__":
    train(
        dataset=DatasetChoice.heart_dyn_refine,
        batch_multiplier=2,
        batch_size=5,
        crit_apply_weight_above_threshold=False,
        crit_beta=1.0,
        crit_decay_weight_by=0.97,
        crit_decay_weight_every_unit=PeriodUnit.iteration,
        crit_decay_weight_every_value=100,
        crit_decay_weight_limit=1.0,
        crit_ms_ssim_weight=0.01,
        crit_threshold=1.0,
        crit_weight=0.001,
        criterion=CriterionChoice.WeightedL1_MS_SSIM,
        data_range=1.0,
        eval_batch_size=5,
        interpolation_order=2,
        lr_sched_factor=0.5,
        lr_sched_patience=10,
        lr_sched_thres=0.0001,
        lr_sched_thres_mode=LRSchedThresMode.abs,
        lr_scheduler=LRSchedulerChoice.ReduceLROnPlateau,
        max_epochs=200,
        model_weights=None, # Path("/g/kreshuk/LF_computed/lnet/logs/heart2/z_out49/f4_b2/20-05-20_10-18-11/train/run000/checkpoints/v1_checkpoint_MSSSIM=0.6722144321961836.pth"),
        opt_lr=5e-4,
        opt_momentum=0.0,
        opt_weight_decay=0.0,
        optimizer=OptimizerChoice.Adam,
        patience=10,
        score_metric=MetricChoice.MS_SSIM,
        seed=None,
        validate_every_unit=PeriodUnit.iteration,
        validate_every_value=400,
        win_sigma=1.5,
        win_size=11,
        # model
        nnum=19,
        z_out=49,
        kernel2d=3,
        c00_2d=1024,
        c01_2d=512,
        c02_2d=256,
        c03_2d=256,
        c04_2d=256,
        up0_2d=128,
        c10_2d=128,
        c11_2d=128,
        c12_2d=128,
        c13_2d=0,
        c14_2d=0,
        up1_2d=0,
        c20_2d=0,
        c21_2d=0,
        c22_2d=0,
        c23_2d=0,
        c24_2d=0,
        up2_2d=0,
        c30_2d=0,
        c31_2d=0,
        c32_2d=0,
        c33_2d=0,
        c34_2d=0,
        last_kernel2d=1,
        cin_3d=16,
        kernel3d=3,
        c00_3d=16,
        c01_3d=16,
        c02_3d=0,
        c03_3d=0,
        c04_3d=0,
        up0_3d=8,
        c10_3d=8,
        c11_3d=4,
        c12_3d=0,
        c13_3d=0,
        c14_3d=0,
        up1_3d=0,
        c20_3d=0,
        c21_3d=0,
        c22_3d=0,
        c23_3d=0,
        c24_3d=0,
        up2_3d=0,
        c30_3d=0,
        c31_3d=0,
        c32_3d=0,
        c33_3d=0,
        c34_3d=0,
        init_fn=HyLFM_Net.InitName.xavier_uniform_,
        final_activation=None,
    )
